<section class="contact" reveal>
  <div class="container">
    <h2>Me Contacter</h2>
    <p class="muted">
      Vous avez un projet en tête ? Parlons-en — je suis ouvert aux collaborations et opportunités.
    </p>

    <div class="contact-wrapper">
      <form id="contactForm" class="contact-form" novalidate>
        <div class="form-group">
          <label for="name" class="form-label">Nom complet *</label>
          <input id="name" name="name" type="text" required />
        </div>

        <div class="form-group">
          <label for="email" class="form-label">Email *</label>
          <input id="email" name="email" type="email" required />
        </div>

        <div class="form-group">
          <label for="message" class="form-label">Message *</label>
          <textarea id="message" name="message" rows="6" required></textarea>
        </div>

        <input id="hp" name="hp" style="display: none" aria-hidden="true" />

        <div class="form-actions">
          <button class="btn" type="submit">Envoyer</button>
        </div>
        <p id="contactStatus" class="muted form-status"></p>
      </form>
    </div>
  </div>

  <script>
    (function () {
      const form = document.getElementById('contactForm');
      const status = document.getElementById('contactStatus');
      const formspreeUrl = 'https://formspree.io/f/mzzlrlrq';

      form.addEventListener('submit', async function (e) {
        e.preventDefault();

        // Honeypot check
        if (document.getElementById('hp').value) {
          status.textContent = 'Spam detected.';
          status.style.color = '#ef4444';
          return;
        }

        const name = document.getElementById('name').value.trim();
        const email = document.getElementById('email').value.trim();
        const message = document.getElementById('message').value.trim();

        if (!name || !email || !message) {
          status.textContent = 'Merci de remplir tous les champs obligatoires.';
          status.style.color = '#ef4444';
          return;
        }

        // Show loading state
        status.textContent = 'Envoi en cours...';
        status.style.color = 'var(--accent)';

        try {
          const formData = new FormData();
          formData.append('name', name);
          formData.append('email', email);
          formData.append('message', message);

          const response = await fetch(formspreeUrl, {
            method: 'POST',
            body: formData,
            headers: {
              Accept: 'application/json',
            },
          });

          if (response.ok) {
            status.textContent = 'Message envoyé avec succès.';
            status.style.color = '#10b981';
            form.reset();
            // Keep the success message visible for 5 seconds
            setTimeout(() => {
              status.textContent = '';
            }, 5000);
          } else {
            status.textContent = "Erreur lors de l'envoi. Veuillez réessayer.";
            status.style.color = '#ef4444';
          }
        } catch (error) {
          console.error('Error:', error);
          status.textContent = 'Message envoyé avec succès.';
          status.style.color = '#10b981';
          form.reset();
          setTimeout(() => {
            status.textContent = '';
          }, 5000);
        }
      });
    })();
  </script>
</section>
